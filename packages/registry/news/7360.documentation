Fixed some pending TODO's and small code amendments. @sneridagh
