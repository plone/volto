# @plone/scripts package

This package is a library of scripts that are useful to automate certain tasks when developing Volto core or Volto projects.

## i18n

It scans and detects i18n messages from the code and add them to the i18n machinery.

See https://6.dev-docs.plone.org/volto/recipes/i18n.html for more information.

This script is installed in the `.bin` directory and can be called via `yarn i18n` or directly in the `scripts` `package.json` part.

## changelogupdater

It updates the changelog according the current defaults in the Volto project.

See how Volto core uses it along with `release-it` for automate the process:

https://github.com/plone/volto/blob/4f52bf61062d1e34e3391ed0a36781b8df98a316/package.json#L173

### Bump

Providing the version, you can update the first `unreleased` literal. `release-it` provides it as a `version` variable.

```shell
yarn changelogupdater bump ${version}
```

### Excerpt

It generates the changelog of the version to be released. This is useful when creating the Release information and sending it to GitHub.

```shell
yarn changelogupdater.js excerpt
```

### Back

It creates the blank placeholder for the next release. Provided the (next) version, it will be added to the placeholder.

```shell
yarn changelogupdater.js back ${version}
```

## addon command

This script creates and configure a project using the Volto generator and configures it to work with the current add-on.
Useful when testing an add-on in a CI environment in isolation, or creating a vainilla project with the add-on already configured and ready to use, eg. for demo purposes or for simple add-on development.

### clone (git)

It clones the add-on into a vanilla project generated by the script.

`npx -p @plone/scripts addon clone [options] <source> [destination]`

    Usage: addon clone [options] <source> [destination]

    clone a repository into a newly created directory

    Options:
      -p, --private          set if the repo is private, then GITHUB_TOKEN is used
      -b, --branch <branch>  set the repo branch, defaults to main
      -c, --canary           downloads latest Volto canary (alpha) version
      -h, --help             display help for command

This next command, would download the `volto-blocks-grid` add-on from its git repo, branch `main` and will generate a project with the latest Volto canary (alpha) version.

```shell
npx -p @plone/scripts addon clone https://github.com/kitconcept/volto-blocks-grid.git --branch main --canary
```

This will create a directory named `addon-testing-project` (this is a sensible default, but you can specify a custom one) and will bootstrap a new project using Volto's standard project generator.
It will adjust the configuration of this project to setup the add-on in the project using `mrs-developer` and the git URL given to fetch the add-on contents.
You can specify the branch to be used, if the project should use the latest alpha available.
There is an option for private repos as well, in that case, it will use the `GITHUB_TOKEN` present in your environment variables to fetch it.

After this, as a developer you can use the usual project commands to run tests (unit, linting, acceptance) inside the generated addon-testing-project`.
You can configure the CI of your choice for automated testing, you can take a look at how it's done in: https://github.com/kitconcept/volto-blocks-grid/tree/main/.github/workflows

The idea is to issue commands inside the generated `addon-testing-project` project and do your checks.
Take special care on how to pass down to the `npx` command the current PR branch.

### clone local

You can also clone the local add-on using:

```shell
npx -p @plone/scripts addon clone .
```

This only works if you execute the command from the root of your add-on directory.

### consolidate

It consolidates the changes made in the previously generated project with the `clone` command into the local add-on.

It should be run at the root of the add-on, and it gets a `source` argument in case you have specified a directory other than `addon-testing-project`.

`npx -p @plone/scripts addon consolidate --help`

    Usage: addon consolidate [options] [source]

    Consolidate a cloned project

    Options:
      -h, --help  display help for command
