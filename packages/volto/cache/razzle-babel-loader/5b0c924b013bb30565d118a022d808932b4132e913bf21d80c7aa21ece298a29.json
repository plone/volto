{"ast":null,"code":"import { Editor, Path, Transforms } from 'slate';\nimport { isCursorInList, getCurrentListItem, mergeWithNextList, mergeWithPreviousList } from '@plone/volto-slate/utils/lists';\nimport { deconstructToVoltoBlocks } from '@plone/volto-slate/utils/volto-blocks';\nimport config from '@plone/volto/registry';\n\n/**\n * @function indentListItems\n * @param {Editor} editor\n * @param {Event} event\n *\n * This bit is quite involved. You need a good understanding of Slate API and\n * Slate's DOM-like behaviour.\n *\n * The markup we're trying to produce is like:\n *\n * ```\n *  <ul>\n *    <li>something</li>\n *    <ul>\n *      <li>else</li>\n *    </ul>\n *  </ul>\n * ```\n *\n * Although not the cleanest, there are numerous advantages to having lists like\n * this:\n * - Code is a lot cleaner, easy to understand and maintain\n * - Google Docs produces the same type of lists\n * - HTML produced by LibreWriter (as witnesed in clipboard transfer) is same\n *\n * See https://github.com/eea/volto-slate/releases/tag/ul_inside_li for an\n * implementation that \"inlines\" the <ul> tags inside <li>. It's not pretty.\n */\nexport function indentListItems({\n  editor,\n  event\n}) {\n  // TODO: test if the cursor is at the beginning of the list item\n\n  // If the text cursor is not in a list, then do nothing.\n  if (!isCursorInList(editor)) {\n    return;\n  } else {\n    // Else prevent the default event handling and bubbling.\n    event.preventDefault();\n    event.stopPropagation();\n\n    // If Shift & Ctrl, decrease multiple items depth. If Shift & !Ctrl,\n    // decrease item depth. If !Shift & Ctrl, increase multiple item depth. If\n    // !Shift & !Ctrl, increase item depth.\n    return event.shiftKey ? event.ctrlKey ? decreaseMultipleItemsDepth(editor, event) : decreaseItemDepth(editor, event) : event.ctrlKey ? increaseMultipleItemDepth(editor, event) : increaseItemDepth(editor, event);\n  }\n}\n\n/**\n * Handle the new Volto blocks created by `deconstructToVoltoBlocks`.\n * @param {Editor} editor The Slate editor object as customized by the\n * volto-slate addon.\n * @param {string[]} newIds The IDs of the newly created Volto blocks.\n */\nconst handleNewVoltoBlocks = (editor, blockIds) => {\n  const props = editor.getBlockProps();\n  props.onSelectBlock(blockIds[blockIds.length - 1]);\n};\n\n/**\n * @function decreaseItemDepth\n *\n * Decreases indent level of a single list item.\n *\n * @param {Editor} editor\n * @param {Event} event\n */\nexport function decreaseItemDepth(editor, event) {\n  const {\n    slate\n  } = config.settings;\n\n  // Current list item being unindented\n  const [listItemNode, listItemPath] = getCurrentListItem(editor);\n\n  // The ul/ol that holds the current list item\n  const [, parentListPath] = Editor.parent(editor, listItemPath);\n\n  // TODO: when unindenting a sublist item, it should take its next siblings\n  // with it as a sublist\n  const listItemRef = Editor.pathRef(editor, listItemPath);\n\n  // TODO: please clarify, we unwrap at list item path but we only unwrap nodes\n  // that match list types, but list item type is different from all list types:\n  Transforms.unwrapNodes(editor, {\n    at: listItemPath,\n    split: true,\n    mode: 'lowest',\n    match: node => slate.listTypes.includes(node.type)\n  });\n\n  /**\n   * This condition is the same as \"listItemRef.current is not the root editor\n   * node or one if its children\".\n   */\n  function getCondition1() {\n    return listItemRef.current.length > 1;\n  }\n\n  /**\n   * @returns The current parent Node of the PathRef linked to the initial list\n   * item that we want deindented.\n   */\n  function getParent() {\n    return Path.parent(listItemRef.current);\n  }\n\n  // Merge with any previous <ul/ol> list\n  if (getCondition1()) mergeWithPreviousList(editor, getParent());\n\n  // Merge with any next <ul/ol> list\n  if (getCondition1()) mergeWithNextList(editor, getParent());\n  if (parentListPath.length === 1) {\n    // Our parent is at root, just under the Editor, where just block nodes can\n    // be, and the user wants to break out so we unwrap the list item. Usually\n    // this means making the list item a `p` just below the Editor in the\n    // document tree, keeping its contents.\n    Transforms.setNodes(editor, {\n      type: slate.defaultBlockType\n    }, {\n      at: listItemRef.current,\n      match: node => node === listItemNode\n    });\n  }\n  listItemRef.unref();\n\n  // If we have more then one child in the editor root, break to volto blocks\n  if (editor.children.length > 1) {\n    deconstructToVoltoBlocks(editor).then(newIds => {\n      handleNewVoltoBlocks(editor, newIds);\n    });\n  }\n  return true;\n}\n\n/**\n * Increases the depth (indent level) of a single list item.\n *\n * @param {Editor} editor\n * @param {Event} event\n */\nexport function increaseItemDepth(editor, event) {\n  // test if there's a sibling ul element above (in this case we insert at end)\n  // or below (then we insert at top)\n\n  // Get the current list item's path.\n  const [, listItemPath] = getCurrentListItem(editor);\n\n  // Get the current list item's parent Node.\n  const [parentList] = Editor.parent(editor, listItemPath);\n  const {\n    slate\n  } = config.settings;\n  const {\n    type\n  } = parentList;\n\n  // If the parent is not a list\n  if (!slate.listTypes.includes(type)) {\n    // Do not increase any indent level. And also, this situation shows that\n    // there is a LI inside something that is not a list, and this means that\n    // something broke the data in the Slate document. TODO: Maybe throw an\n    // exception?\n    return false; // false means that the event was not practically handled\n  }\n\n  /**\n   * Create a list of the same type as the parent list and put the specified\n   * list item in it, then put the new list inside the parent list.\n   */\n  function wrapListItem() {\n    Transforms.wrapNodes(editor,\n    // `children` property is added automatically as an empty array then\n    // normalized\n    {\n      type: type\n    }, {\n      at: listItemPath\n    });\n  }\n\n  // If the parent list is just below the Editor node\n  if (parentList.children.length === 1) {\n    // There should be just one block node inside the Editor node in volto-slate\n    // (what about table cells? currently they allow multiple paragraphs in\n    // them), so there should be no previous or next sibling.\n    wrapListItem();\n    return true;\n  }\n  wrapListItem();\n\n  // listItemPath was wrapped in a node, so it now points to a list\n  const currentListRef = Editor.pathRef(editor, listItemPath);\n\n  // Merge with any previous <ul/ol> list\n  mergeWithPreviousList(editor, currentListRef.current);\n\n  // Merge with any next <ul/ol> list\n  mergeWithNextList(editor, currentListRef.current);\n  currentListRef.unref();\n  return true;\n}\n\n/**\n * [Not implemented] Indents current list item + plus siblings that come after\n * it.\n * @param {Editor} editor\n * @param {Event} event\n */\nexport function increaseMultipleItemDepth(editor, event) {\n  // TODO: implement\n}\n\n/**\n * [Not implemented] Un-indents current list item + plus siblings that come\n * after it.\n * @param {Editor} editor\n * @param {Event} event\n */\nexport function decreaseMultipleItemsDepth(editor, event) {\n  // TODO: implement\n}","map":{"version":3,"names":["Editor","Path","Transforms","isCursorInList","getCurrentListItem","mergeWithNextList","mergeWithPreviousList","deconstructToVoltoBlocks","config","indentListItems","editor","event","preventDefault","stopPropagation","shiftKey","ctrlKey","decreaseMultipleItemsDepth","decreaseItemDepth","increaseMultipleItemDepth","increaseItemDepth","handleNewVoltoBlocks","blockIds","props","getBlockProps","onSelectBlock","length","slate","settings","listItemNode","listItemPath","parentListPath","parent","listItemRef","pathRef","unwrapNodes","at","split","mode","match","node","listTypes","includes","type","getCondition1","current","getParent","setNodes","defaultBlockType","unref","children","then","newIds","parentList","wrapListItem","wrapNodes","currentListRef"],"sources":["/Users/varshanmaji/Projects/volto/packages/volto-slate/src/blocks/Text/keyboard/indentListItems.js"],"sourcesContent":["import { Editor, Path, Transforms } from 'slate';\nimport {\n  isCursorInList,\n  getCurrentListItem,\n  mergeWithNextList,\n  mergeWithPreviousList,\n} from '@plone/volto-slate/utils/lists';\nimport { deconstructToVoltoBlocks } from '@plone/volto-slate/utils/volto-blocks';\nimport config from '@plone/volto/registry';\n\n/**\n * @function indentListItems\n * @param {Editor} editor\n * @param {Event} event\n *\n * This bit is quite involved. You need a good understanding of Slate API and\n * Slate's DOM-like behaviour.\n *\n * The markup we're trying to produce is like:\n *\n * ```\n *  <ul>\n *    <li>something</li>\n *    <ul>\n *      <li>else</li>\n *    </ul>\n *  </ul>\n * ```\n *\n * Although not the cleanest, there are numerous advantages to having lists like\n * this:\n * - Code is a lot cleaner, easy to understand and maintain\n * - Google Docs produces the same type of lists\n * - HTML produced by LibreWriter (as witnesed in clipboard transfer) is same\n *\n * See https://github.com/eea/volto-slate/releases/tag/ul_inside_li for an\n * implementation that \"inlines\" the <ul> tags inside <li>. It's not pretty.\n */\nexport function indentListItems({ editor, event }) {\n  // TODO: test if the cursor is at the beginning of the list item\n\n  // If the text cursor is not in a list, then do nothing.\n  if (!isCursorInList(editor)) {\n    return;\n  } else {\n    // Else prevent the default event handling and bubbling.\n    event.preventDefault();\n    event.stopPropagation();\n\n    // If Shift & Ctrl, decrease multiple items depth. If Shift & !Ctrl,\n    // decrease item depth. If !Shift & Ctrl, increase multiple item depth. If\n    // !Shift & !Ctrl, increase item depth.\n    return event.shiftKey\n      ? event.ctrlKey\n        ? decreaseMultipleItemsDepth(editor, event)\n        : decreaseItemDepth(editor, event)\n      : event.ctrlKey\n        ? increaseMultipleItemDepth(editor, event)\n        : increaseItemDepth(editor, event);\n  }\n}\n\n/**\n * Handle the new Volto blocks created by `deconstructToVoltoBlocks`.\n * @param {Editor} editor The Slate editor object as customized by the\n * volto-slate addon.\n * @param {string[]} newIds The IDs of the newly created Volto blocks.\n */\nconst handleNewVoltoBlocks = (editor, blockIds) => {\n  const props = editor.getBlockProps();\n  props.onSelectBlock(blockIds[blockIds.length - 1]);\n};\n\n/**\n * @function decreaseItemDepth\n *\n * Decreases indent level of a single list item.\n *\n * @param {Editor} editor\n * @param {Event} event\n */\nexport function decreaseItemDepth(editor, event) {\n  const { slate } = config.settings;\n\n  // Current list item being unindented\n  const [listItemNode, listItemPath] = getCurrentListItem(editor);\n\n  // The ul/ol that holds the current list item\n  const [, parentListPath] = Editor.parent(editor, listItemPath);\n\n  // TODO: when unindenting a sublist item, it should take its next siblings\n  // with it as a sublist\n  const listItemRef = Editor.pathRef(editor, listItemPath);\n\n  // TODO: please clarify, we unwrap at list item path but we only unwrap nodes\n  // that match list types, but list item type is different from all list types:\n  Transforms.unwrapNodes(editor, {\n    at: listItemPath,\n    split: true,\n    mode: 'lowest',\n    match: (node) => slate.listTypes.includes(node.type),\n  });\n\n  /**\n   * This condition is the same as \"listItemRef.current is not the root editor\n   * node or one if its children\".\n   */\n  function getCondition1() {\n    return listItemRef.current.length > 1;\n  }\n\n  /**\n   * @returns The current parent Node of the PathRef linked to the initial list\n   * item that we want deindented.\n   */\n  function getParent() {\n    return Path.parent(listItemRef.current);\n  }\n\n  // Merge with any previous <ul/ol> list\n  if (getCondition1()) mergeWithPreviousList(editor, getParent());\n\n  // Merge with any next <ul/ol> list\n  if (getCondition1()) mergeWithNextList(editor, getParent());\n\n  if (parentListPath.length === 1) {\n    // Our parent is at root, just under the Editor, where just block nodes can\n    // be, and the user wants to break out so we unwrap the list item. Usually\n    // this means making the list item a `p` just below the Editor in the\n    // document tree, keeping its contents.\n    Transforms.setNodes(\n      editor,\n      { type: slate.defaultBlockType },\n      {\n        at: listItemRef.current,\n        match: (node) => node === listItemNode,\n      },\n    );\n  }\n\n  listItemRef.unref();\n\n  // If we have more then one child in the editor root, break to volto blocks\n  if (editor.children.length > 1) {\n    deconstructToVoltoBlocks(editor).then((newIds) => {\n      handleNewVoltoBlocks(editor, newIds);\n    });\n  }\n\n  return true;\n}\n\n/**\n * Increases the depth (indent level) of a single list item.\n *\n * @param {Editor} editor\n * @param {Event} event\n */\nexport function increaseItemDepth(editor, event) {\n  // test if there's a sibling ul element above (in this case we insert at end)\n  // or below (then we insert at top)\n\n  // Get the current list item's path.\n  const [, listItemPath] = getCurrentListItem(editor);\n\n  // Get the current list item's parent Node.\n  const [parentList] = Editor.parent(editor, listItemPath);\n\n  const { slate } = config.settings;\n  const { type } = parentList;\n\n  // If the parent is not a list\n  if (!slate.listTypes.includes(type)) {\n    // Do not increase any indent level. And also, this situation shows that\n    // there is a LI inside something that is not a list, and this means that\n    // something broke the data in the Slate document. TODO: Maybe throw an\n    // exception?\n    return false; // false means that the event was not practically handled\n  }\n\n  /**\n   * Create a list of the same type as the parent list and put the specified\n   * list item in it, then put the new list inside the parent list.\n   */\n  function wrapListItem() {\n    Transforms.wrapNodes(\n      editor,\n      // `children` property is added automatically as an empty array then\n      // normalized\n      { type: type },\n      {\n        at: listItemPath,\n      },\n    );\n  }\n\n  // If the parent list is just below the Editor node\n  if (parentList.children.length === 1) {\n    // There should be just one block node inside the Editor node in volto-slate\n    // (what about table cells? currently they allow multiple paragraphs in\n    // them), so there should be no previous or next sibling.\n    wrapListItem();\n    return true;\n  }\n\n  wrapListItem();\n\n  // listItemPath was wrapped in a node, so it now points to a list\n  const currentListRef = Editor.pathRef(editor, listItemPath);\n\n  // Merge with any previous <ul/ol> list\n  mergeWithPreviousList(editor, currentListRef.current);\n\n  // Merge with any next <ul/ol> list\n  mergeWithNextList(editor, currentListRef.current);\n\n  currentListRef.unref();\n\n  return true;\n}\n\n/**\n * [Not implemented] Indents current list item + plus siblings that come after\n * it.\n * @param {Editor} editor\n * @param {Event} event\n */\nexport function increaseMultipleItemDepth(editor, event) {\n  // TODO: implement\n}\n\n/**\n * [Not implemented] Un-indents current list item + plus siblings that come\n * after it.\n * @param {Editor} editor\n * @param {Event} event\n */\nexport function decreaseMultipleItemsDepth(editor, event) {\n  // TODO: implement\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}